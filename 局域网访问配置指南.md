# 局域网访问配置指南

## 当前网络信息
- **本机 IP 地址**: `10.1.65.48`
- **局域网段**: `10.1.65.0/23`

## 配置步骤

### 1. 修改 Next.js 启动配置

修改 `package.json` 中的 `dev` 脚本，允许外部访问：

```json
"dev": "next dev -H 0.0.0.0"
```

或者使用完整形式：
```json
"dev": "next dev --hostname 0.0.0.0 --port 3000"
```

### 2. 更新 MinIO 配置

修改 `.env.local` 文件中的 MinIO 配置：

```env
# MinIO 对象存储配置 - 局域网访问
MINIO_ENDPOINT=10.1.65.48
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=change-me-now
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=change-me-now
MINIO_PRIMARY_ENDPOINT=http://10.1.65.48:9000
MINIO_PRIMARY_ACCESS_KEY=admin
MINIO_PRIMARY_SECRET_KEY=change-me-now
MINIO_BACKUP_TARGET=./data/minio-backup
```

### 3. 启动服务

在项目根目录下执行：

```bash
cd /Users/yangguang/Desktop/EHS/EHS-system
npm run dev
```

### 4. 局域网内其他设备访问

局域网内的其他电脑可以通过以下地址访问：

- **Web 应用**: `http://10.1.65.48:3000`
- **MinIO 控制台**: `http://10.1.65.48:9001` (如果启动了 MinIO 控制台)
- **MinIO API**: `http://10.1.65.48:9000`

### 5. 防火墙设置 (macOS)

确保防火墙允许相关端口：

```bash
# 检查防火墙状态
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# 如果需要添加 Node.js 到允许列表
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp /usr/local/bin/node
```

或者在"系统偏好设置" > "安全性与隐私" > "防火墙"中添加应用程序。

## 验证连接

### 从其他设备测试连接

1. **测试 Web 应用连接**:
   ```bash
   # 在其他设备上执行
   curl http://10.1.65.48:3000
   ```

2. **测试 MinIO 连接**:
   ```bash
   # 在其他设备上执行
   curl http://10.1.65.48:9000/minio/health/live
   ```

## 常见问题

### Q1: 其他设备无法访问

**解决方案**:
1. 检查本机防火墙设置
2. 确认两台设备在同一局域网
3. 尝试 ping 测试：`ping 10.1.65.48`

### Q2: MinIO 文件上传失败

**解决方案**:
1. 确认 `.env.local` 中的 `MINIO_ENDPOINT` 已更新为 `10.1.65.48`
2. 重启服务以应用新配置
3. 检查浏览器控制台是否有 CORS 错误

### Q3: IP 地址变化

如果本机 IP 地址变化（DHCP 分配），需要：
1. 查看新的 IP 地址：`ifconfig | grep "inet " | grep -v 127.0.0.1`
2. 更新 `.env.local` 中的 IP 地址
3. 重启服务

## 生产环境建议

对于生产环境，建议：

1. **使用固定 IP 地址**：在路由器中为服务器设置 DHCP 静态绑定

2. **使用域名**：配置内网 DNS 或使用 hosts 文件
   ```
   10.1.65.48  ehs.local
   ```

3. **启用 HTTPS**：配置 SSL 证书以提高安全性

4. **环境变量管理**：
   - 开发环境使用 `.env.local`
   - 生产环境使用 `.env.production`

## 快速启动脚本

创建一个启动脚本 `start-lan.sh`：

```bash
#!/bin/bash
cd /Users/yangguang/Desktop/EHS/EHS-system
export HOST=0.0.0.0
npm run dev
```

使其可执行：
```bash
chmod +x start-lan.sh
```

运行：
```bash
./start-lan.sh
```

## 安全注意事项

⚠️ **重要提示**:

1. 仅在受信任的局域网内使用此配置
2. 不要将此配置用于公网暴露
3. 定期更改 MinIO 的访问密钥
4. 考虑使用 VPN 进行远程访问
5. 启用访问日志以监控异常访问
