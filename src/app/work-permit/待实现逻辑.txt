è¦å®ç°â€œè½¯åˆ é™¤â€ï¼ˆSoft Deleteï¼‰ï¼Œä½ éœ€è¦ä¿®æ”¹ **æ•°æ®åº“æ¨¡å‹** å’Œ **åç«¯ API é€»è¾‘**ã€‚å‰ç«¯ä»£ç é€šå¸¸ä¸éœ€è¦æ”¹åŠ¨ï¼ˆå› ä¸ºå‰ç«¯åªè´Ÿè´£è°ƒç”¨ DELETE æ¥å£ï¼Œè‡³äºåç«¯æ˜¯çœŸåˆ è¿˜æ˜¯å‡åˆ ï¼Œå‰ç«¯æ— æ„ŸçŸ¥ï¼‰ã€‚

ä»¥ä¸‹æ˜¯å…·ä½“çš„ä¿®æ”¹æ­¥éª¤å’Œæ–‡ä»¶ä½ç½®ï¼š

### ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹æ•°æ®åº“æ¨¡å‹ (Prisma Schema)

è¿™æ˜¯æœ€åŸºç¡€çš„ä¸€æ­¥ã€‚ä½ éœ€è¦ç»™è¡¨å¢åŠ ä¸€ä¸ªæ ‡è®°åˆ é™¤æ—¶é—´çš„å­—æ®µã€‚

**æ–‡ä»¶ï¼š** `prisma/schema.prisma` (è¯¥æ–‡ä»¶ä½ æœªä¸Šä¼ ï¼Œä½†åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹)

**ä¿®æ”¹å†…å®¹ï¼š**
æ‰¾åˆ° `model WorkPermitRecord`ï¼Œç»™å®ƒå¢åŠ ä¸€ä¸ªå¯é€‰çš„ `deletedAt` å­—æ®µã€‚

```prisma
model WorkPermitRecord {
  id          String   @id @default(cuid())
  // ... å…¶ä»–å­—æ®µä¿æŒä¸å˜
  
  // ğŸŸ¢ æ–°å¢ï¼šåˆ é™¤æ—¶é—´ (ä¸ºç©ºä»£è¡¨æœªåˆ é™¤ï¼Œæœ‰æ—¶é—´ä»£è¡¨å·²åˆ é™¤)
  deletedAt   DateTime? 
}

```

*ä¿®æ”¹å®Œåï¼Œè®°å¾—è¿è¡Œ `npx prisma db push` æˆ– `npx prisma migrate dev` æ¥åŒæ­¥æ•°æ®åº“ç»“æ„ã€‚*

---

### ç¬¬äºŒæ­¥ï¼šä¿®æ”¹åç«¯ API (`route.ts`)

ä½ éœ€è¦ä¿®æ”¹ **æŸ¥è¯¢é€»è¾‘ï¼ˆGETï¼‰** å’Œ **åˆ é™¤é€»è¾‘ï¼ˆDELETEï¼‰**ã€‚

**æ–‡ä»¶ï¼š** `src/app/api/permits/route.ts`

#### 1. ä¿®æ”¹ GET æ–¹æ³• (åªæŸ¥æœªåˆ é™¤çš„)

æ‰¾åˆ° `export async function GET(req: Request)` å‡½æ•°ï¼Œä¿®æ”¹æŸ¥è¯¢æ¡ä»¶ã€‚

```typescript
// src/app/api/permits/route.ts

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const projectId = searchParams.get('projectId');

  try {
    // ğŸŸ¢ ä¿®æ”¹å‰ï¼šconst whereCondition = projectId ? { projectId } : {};
    
    // ğŸŸ¢ ä¿®æ”¹åï¼šå¼ºåˆ¶å¢åŠ  deletedAt: null æ¡ä»¶
    const whereCondition = {
      ...(projectId ? { projectId } : {}), // å¦‚æœæœ‰ projectId å°±åŠ ä¸Š
      deletedAt: null                      // âœ… åªæŸ¥è¯¢ deletedAt ä¸ºç©ºçš„è®°å½•
    };

    const records = await prisma.workPermitRecord.findMany({
      where: whereCondition,
      include: { 
        template: true, 
        project: true   
      },
      orderBy: { createdAt: 'desc' }
    });
    return NextResponse.json(records);
  } catch (error) {
    return NextResponse.json({ error: 'è·å–è®°å½•å¤±è´¥' }, { status: 500 });
  }
}

```

#### 2. ä¿®æ”¹ DELETE æ–¹æ³• (æ‰§è¡Œè½¯åˆ é™¤)

æ‰¾åˆ° `export async function DELETE(req: Request)` å‡½æ•°ï¼ŒæŠŠ `delete` æ¢æˆ `update`ã€‚

```typescript
// src/app/api/permits/route.ts

export async function DELETE(req: Request) {
  try {
    const { searchParams } = new URL(req.url);
    const id = searchParams.get('id');
    if (!id) return NextResponse.json({ error: 'ç¼ºå°‘ ID' }, { status: 400 });

    // ğŸ”´ ä¿®æ”¹å‰ (ç¡¬åˆ é™¤)ï¼š
    // await prisma.workPermitRecord.delete({ where: { id } });

    // ğŸŸ¢ ä¿®æ”¹å (è½¯åˆ é™¤)ï¼š
    await prisma.workPermitRecord.update({
      where: { id },
      data: { 
        deletedAt: new Date() // âœ… ä¸åˆ æ•°æ®ï¼Œåªæ‰“ä¸Šæ—¶é—´æˆ³
      }
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: 'åˆ é™¤å¤±è´¥' }, { status: 500 });
  }
}

```

---

### ç¬¬ä¸‰æ­¥ï¼š(å¯é€‰) é¡¹ç›®çš„è½¯åˆ é™¤

å¦‚æœä½ å¸Œæœ›â€œé¡¹ç›® (Project)â€ä¹Ÿæ”¯æŒè½¯åˆ é™¤ï¼Œä½ éœ€è¦å¯¹ `src/app/api/projects/route.ts` åšåŒæ ·çš„ä¿®æ”¹ï¼š

1. `schema.prisma` é‡Œçš„ `model Project` å¢åŠ  `deletedAt DateTime?`ã€‚
2. `api/projects/route.ts` é‡Œçš„ `GET` å¢åŠ  `where: { deletedAt: null }`ã€‚
3. `api/projects/route.ts` é‡Œçš„ `DELETE` æ”¹ä¸º `update` è®¾ç½® `deletedAt`ã€‚

### æ€»ç»“

ä½ åªéœ€è¦åŠ¨ä¸¤ä¸ªåœ°æ–¹ï¼š

1. **æ•°æ®åº“** (`schema.prisma`)ï¼šåŠ å­—æ®µã€‚
2. **åç«¯** (`route.ts`)ï¼šGET æ—¶è¿‡æ»¤ï¼ŒDELETE æ—¶æ›´æ–°ã€‚

å‰ç«¯é¡µé¢ (`page.tsx` ç­‰) ä¸éœ€è¦ä¿®æ”¹ï¼Œå› ä¸ºè½¯åˆ é™¤åï¼ŒAPI è¿”å›çš„åˆ—è¡¨è‡ªç„¶å°±ä¸åŒ…å«å·²åˆ é™¤çš„æ•°æ®äº†ï¼Œè§†è§‰æ•ˆæœå’ŒçœŸåˆ ä¸€æ ·ï¼Œä½†æ•°æ®åœ¨æ•°æ®åº“é‡Œæ˜¯å®‰å…¨çš„ã€‚