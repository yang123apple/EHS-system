# 移动端表单功能使用指南

## 功能概述

本系统现已支持移动端优化的表单填写体验。管理员可以为每个作业票模板配置专门的移动端表单布局，在小屏幕设备上，用户将看到更易于填写的垂直堆叠表单，而不是传统的表格布局。

## 功能特点

- ✅ **响应式设计**：自动检测设备屏幕大小，在移动端显示优化的表单
- ✅ **灵活配置**：为每个模板单独配置移动端表单字段
- ✅ **多种字段类型**：支持文本、数字、日期、下拉选择、部门选择、人员选择等
- ✅ **数据一致性**：移动端表单与桌面端表格共享同一数据源
- ✅ **用户体验优化**：带图标的输入框、必填项标识、占位符提示

## 使用步骤

### 1. 配置移动端表单（管理员操作）

1. 进入**作业票管理**页面
2. 点击**模板管理**按钮
3. 选择要编辑的模板，点击**编辑**按钮
4. 在模板编辑器中，点击工具栏上的**📱 移动端表单**按钮
5. 在弹出的移动端表单编辑器中：
   - 勾选**启用移动端表单**
   - 系统会自动从模板中解析字段生成初始表单配置
   - 可以调整字段顺序（使用上下箭头）
   - 可以编辑字段属性（标签、类型、占位符、必填等）
   - 可以删除不需要的字段
   - 可以添加新字段
6. 点击**保存配置**
7. 点击模板编辑器的**保存**按钮

### 2. 移动端填写作业票（普通用户）

1. 在移动设备上打开系统
2. 进入**作业票管理**页面
3. 点击**新建作业票**按钮
4. 选择项目
5. 选择模板（如果模板配置了移动端表单，会显示"📱"图标）
6. 点击**开始填写**
7. 在移动端表单中填写信息：
   - 所有字段垂直排列，方便单手操作
   - 日期字段显示日期选择器图标
   - 部门/人员字段显示对应图标
   - 必填字段标有红色星号
8. 填写完成后，添加附件（可选）
9. 输入申请人附言（可选）
10. 点击**提交申请**

## 字段类型说明

| 字段类型 | 说明 | 示例 |
|---------|------|------|
| **text** | 单行文本输入 | 姓名、地点等 |
| **textarea** | 多行文本输入 | 作业内容、风险分析等 |
| **number** | 数字输入 | 人数、温度等 |
| **date** | 日期选择 | 开始日期、结束日期 |
| **select** | 下拉选择 | 作业类型、风险等级 |
| **department** | 部门选择 | 施工部门、监管部门 |
| **user** | 人员选择 | 负责人、联系人 |

## 屏幕尺寸适配

- **小屏幕（< 768px）**：自动显示移动端表单（如果已配置）
- **大屏幕（≥ 768px）**：显示传统表格布局
- 数据在两种视图间自动同步，无需担心数据丢失

## 注意事项

1. **配置优先级**：只有启用了移动端表单配置的模板才会在移动端显示优化表单
2. **字段映射**：移动端表单字段的 `fieldKey` 必须与模板中的字段名一致
3. **必填验证**：浏览器会自动验证必填字段，确保数据完整性
4. **签名字段**：签名类型的字段会在审批流程中自动处理，不需要在移动端表单中配置
5. **Section字段**：嵌套的子模板字段暂不支持在移动端表单中配置

## 最佳实践

1. **精简字段**：移动端表单建议只包含必要字段，避免过长的表单
2. **合理排序**：将重要字段放在前面，减少用户滚动
3. **清晰标签**：使用简短明确的字段标签
4. **占位符提示**：善用占位符提供输入示例
5. **必填标识**：合理设置必填字段，保证数据质量

## 技术实现

- **前端框架**：React + TypeScript
- **样式方案**：Tailwind CSS
- **响应式断点**：使用 `md:` (768px) 作为移动端/桌面端分界点
- **数据结构**：JSON 格式存储在模板的 `mobileFormConfig` 字段
- **组件架构**：
  - `MobileFormEditor`：移动端表单配置编辑器
  - `AddPermitModal`：作业票创建弹窗（包含移动端表单渲染逻辑）

## 更新日志

### v1.0.0 (2025-12-23)
- ✨ 新增移动端表单编辑器
- ✨ 支持在新建作业票时自动渲染移动端表单
- ✨ 支持7种字段类型的移动端渲染
- ✨ 添加数据库字段 `mobileFormConfig` 存储配置
- ✨ 添加响应式视图切换逻辑

## 问题反馈

如果在使用过程中遇到问题，请联系系统管理员或提交 Issue。
