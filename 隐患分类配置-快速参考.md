# 隐患分类配置 - 快速参考

## 🔧 问题已修复

✅ 隐患分类配置现已正确保存到数据库  
✅ 重启或刷新不会丢失您的自定义配置  
✅ seed.ts 已更新，新部署会自动初始化配置

## 📖 如何修改隐患分类

### 方法 1: 通过管理页面（推荐）

1. 访问 **隐患管理** → **工作流配置**
2. 找到 **隐患分类** 配置区域
3. 添加、删除或修改分类
4. 点击 **保存配置** 按钮
5. 等待成功提示

**⚠️ 重要**: 必须点击"保存配置"，否则修改不会保存到数据库！

### 方法 2: 直接修改数据库

```javascript
// 使用 Prisma Client
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

await prisma.hazardConfig.update({
  where: { key: 'hazard_types' },
  data: {
    value: JSON.stringify(['新类型1', '新类型2', '新类型3']),
    updatedAt: new Date()
  }
});
```

### 方法 3: 使用 API

```bash
# POST /api/hazards/config
curl -X POST http://localhost:3000/api/hazards/config \
  -H "Content-Type: application/json" \
  -d '{"types": ["新类型1", "新类型2", "新类型3"]}'
```

## 🔍 验证配置

### 查看当前配置
```bash
node check-hazard-config.js
```

### 重新初始化（重置为默认值）
```bash
# 1. 删除现有配置
node -e "const {PrismaClient}=require('@prisma/client');const p=new PrismaClient();p.hazardConfig.delete({where:{key:'hazard_types'}}).then(()=>p.\$disconnect());"

# 2. 运行初始化
node init-hazard-config.js
```

## 📂 相关文件

| 文件 | 说明 |
|------|------|
| `prisma/seed.ts` | 数据库初始化脚本（已更新） |
| `init-hazard-config.js` | 配置初始化工具 |
| `check-hazard-config.js` | 配置检查工具 |
| `src/app/api/hazards/config/route.ts` | 配置 API |

## 🚀 新部署清单

部署到新环境时，确保执行：

```bash
# 1. 安装依赖
npm install

# 2. 数据库迁移
npx prisma migrate deploy

# 3. 初始化数据（包含隐患配置）
npx prisma db seed
```

## ❓ 常见问题

**Q: 为什么之前的修改会丢失？**  
A: 因为配置没有保存到数据库，只在内存中存在。系统重启后就恢复默认值。

**Q: 如何确认配置已保存？**  
A: 运行 `node check-hazard-config.js` 查看数据库中的配置。

**Q: 可以批量导入分类吗？**  
A: 可以通过修改 `value` 字段的 JSON 数组实现。

**Q: 删除分类会影响现有隐患吗？**  
A: 不会。现有隐患记录的 `type` 字段是文本，不会受配置变化影响。

---

**最后更新**: 2026-01-04  
**修复版本**: v1.0.1
