# æ“ä½œæ—¥å¿—ç³»ç»Ÿ - ä¸šåŠ¡ç¼–å·è§„èŒƒ

## âš ï¸ é‡è¦ï¼šä½¿ç”¨ä¸šåŠ¡ç¼–å·è€Œéæ•°æ®åº“ID

åœ¨è®°å½•æ“ä½œæ—¥å¿—æ—¶ï¼Œ**å¿…é¡»ä½¿ç”¨ä¸šåŠ¡ç³»ç»Ÿçš„ç¼–å·ä½œä¸º `targetId`**ï¼Œè€Œä¸æ˜¯æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„IDã€‚

### âœ… æ­£ç¡®ç¤ºä¾‹

```typescript
// éšæ‚£ç³»ç»Ÿ - ä½¿ç”¨éšæ‚£ç¼–å·
await ActivityLogger.logCreate({
  userId: user.id,
  module: Modules.HAZARD,
  targetType: 'hazard',
  targetId: hazard.code,              // âœ… ä½¿ç”¨éšæ‚£ç¼–å·ï¼ˆå¦‚ HZ-2024-001ï¼‰
  targetLabel: hazard.desc?.substring(0, 50),  // éšæ‚£æè¿°ï¼ˆå¯é€‰ï¼‰
  data: hazard,
  request,
});

// æ–‡æ¡£ç³»ç»Ÿ - ä½¿ç”¨æ–‡æ¡£ç¼–å·
await ActivityLogger.logCreate({
  userId: user.id,
  module: Modules.DOCUMENT,
  targetType: 'document',
  targetId: document.code,            // âœ… ä½¿ç”¨æ–‡æ¡£ç¼–å·ï¼ˆå¦‚ DOC-2024-001ï¼‰
  targetLabel: document.title,        // æ–‡æ¡£æ ‡é¢˜
  data: document,
  request,
});

// ä½œä¸šè®¸å¯ - ä½¿ç”¨è®¸å¯è¯ç¼–å·
await ActivityLogger.logCreate({
  userId: user.id,
  module: Modules.PERMIT,
  targetType: 'permit',
  targetId: permit.code,              // âœ… ä½¿ç”¨è®¸å¯è¯ç¼–å·ï¼ˆå¦‚ JOB-2024-001ï¼‰
  targetLabel: permit.workType,       // ä½œä¸šç±»å‹
  data: permit,
  request,
});

// åŸ¹è®­ä»»åŠ¡ - ä½¿ç”¨ä»»åŠ¡ç¼–å·
await ActivityLogger.logCreate({
  userId: user.id,
  module: Modules.TRAINING,
  targetType: 'training',
  targetId: task.code,                // âœ… ä½¿ç”¨ä»»åŠ¡ç¼–å·ï¼ˆå¦‚ TRAIN-2024-001ï¼‰
  targetLabel: task.title,            // ä»»åŠ¡æ ‡é¢˜
  data: task,
  request,
});
```

### âŒ é”™è¯¯ç¤ºä¾‹

```typescript
// âŒ ä¸è¦ä½¿ç”¨æ•°æ®åº“ID
await ActivityLogger.logCreate({
  userId: user.id,
  module: Modules.HAZARD,
  targetType: 'hazard',
  targetId: hazard.id,                // âŒ æ•°æ®åº“IDï¼ˆå¦‚ clx123abc...ï¼‰
  targetLabel: `éšæ‚£ ${hazard.code}`,
  data: hazard,
  request,
});
```

## ğŸ“‹ å„ç³»ç»Ÿç¼–å·è§„èŒƒ

### éšæ‚£ç®¡ç†ç³»ç»Ÿ
- **å­—æ®µå**: `code`
- **æ ¼å¼**: `HZ-YYYY-åºå·` æˆ–è‡ªå®šä¹‰æ ¼å¼
- **ç¤ºä¾‹**: `HZ-2024-001`, `HZ-2024-002`

```typescript
targetId: hazard.code
targetLabel: hazard.desc?.substring(0, 50)  // éšæ‚£æè¿°ï¼ˆå‰50å­—ï¼‰
```

### æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ
- **å­—æ®µå**: `code` æˆ– `docNo`
- **æ ¼å¼**: `DOC-YYYY-åºå·` æˆ–è‡ªå®šä¹‰æ ¼å¼
- **ç¤ºä¾‹**: `DOC-2024-001`, `DOC-2024-002`

```typescript
targetId: document.code
targetLabel: document.title  // æ–‡æ¡£æ ‡é¢˜
```

### ä½œä¸šè®¸å¯ç³»ç»Ÿ
- **å­—æ®µå**: `code` æˆ– `permitNo`
- **æ ¼å¼**: `JOB-YYYY-åºå·` æˆ–è‡ªå®šä¹‰æ ¼å¼
- **ç¤ºä¾‹**: `JOB-2024-001`, `WORK-2024-001`

```typescript
targetId: permit.code
targetLabel: `${permit.workType} - ${permit.location}`  // ä½œä¸šç±»å‹-ä½ç½®
```

### åŸ¹è®­ç®¡ç†ç³»ç»Ÿ
- **å­—æ®µå**: `code` æˆ– `taskNo`
- **æ ¼å¼**: `TRAIN-YYYY-åºå·` æˆ–è‡ªå®šä¹‰æ ¼å¼
- **ç¤ºä¾‹**: `TRAIN-2024-001`, `TRAIN-2024-002`

```typescript
targetId: task.code
targetLabel: task.title  // åŸ¹è®­ä»»åŠ¡æ ‡é¢˜
```

### ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- **å­—æ®µå**: `username` æˆ– `employeeNo`
- **æ ¼å¼**: å·¥å·æˆ–ç”¨æˆ·å
- **ç¤ºä¾‹**: `EMP001`, `zhangsan`

```typescript
targetId: user.username  // æˆ– user.employeeNo
targetLabel: user.name   // ç”¨æˆ·å§“å
```

### ç»„ç»‡æ¶æ„ç³»ç»Ÿ
- **å­—æ®µå**: `code` æˆ– `deptCode`
- **æ ¼å¼**: éƒ¨é—¨ç¼–ç 
- **ç¤ºä¾‹**: `DEPT-001`, `IT-001`

```typescript
targetId: department.code
targetLabel: department.name  // éƒ¨é—¨åç§°
```

## ğŸ¯ å­—æ®µè¯´æ˜

### targetIdï¼ˆå¿…å¡«ï¼‰
- **ä½œç”¨**: å”¯ä¸€æ ‡è¯†è¢«æ“ä½œçš„å¯¹è±¡
- **è¦æ±‚**: ä½¿ç”¨ä¸šåŠ¡ç³»ç»Ÿçš„ç¼–å·ï¼Œä¸æ˜¯æ•°æ®åº“ID
- **ç‰¹ç‚¹**: 
  - å¯¹ç”¨æˆ·å‹å¥½
  - ä¾¿äºæŸ¥è¯¢å’Œè¿½æº¯
  - è·¨ç³»ç»Ÿå¯è¯†åˆ«
  - å³ä½¿æ•°æ®è¿ç§»ä¹Ÿä¿æŒä¸€è‡´

### targetLabelï¼ˆå¯é€‰ï¼‰
- **ä½œç”¨**: æä¾›å¯¹è±¡çš„å¯è¯»æè¿°
- **å»ºè®®å†…å®¹**: æ ‡é¢˜ã€æè¿°ã€åç§°ç­‰
- **é•¿åº¦**: å»ºè®®æ§åˆ¶åœ¨100å­—ä»¥å†…
- **ç¤ºä¾‹**:
  - éšæ‚£ï¼šéšæ‚£æè¿°çš„å‰50å­—
  - æ–‡æ¡£ï¼šæ–‡æ¡£æ ‡é¢˜
  - ä»»åŠ¡ï¼šä»»åŠ¡æ ‡é¢˜
  - ç”¨æˆ·ï¼šç”¨æˆ·å§“å

### targetTypeï¼ˆå¿…å¡«ï¼‰
- **ä½œç”¨**: æ ‡è¯†å¯¹è±¡ç±»å‹
- **æ ¼å¼**: å°å†™è‹±æ–‡
- **å¸¸ç”¨å€¼**: `hazard`, `document`, `permit`, `training`, `user`, `org`

## ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨ä¸šåŠ¡ç¼–å·ï¼Ÿ

### 1. å¯è¯»æ€§
```
âœ… targetId: "HZ-2024-001"  æ¸…æ™°æ˜äº†
âŒ targetId: "clx7k3m9n0000..."  éš¾ä»¥è¯†åˆ«
```

### 2. æŒä¹…æ€§
- ä¸šåŠ¡ç¼–å·ä¸å˜ï¼Œå³ä½¿æ•°æ®è¿ç§»
- æ•°æ®åº“IDå¯èƒ½åœ¨è¿ç§»æ—¶æ”¹å˜

### 3. è·¨ç³»ç»Ÿè¿½æº¯
- ä¸šåŠ¡ç¼–å·åœ¨å„ä¸ªç³»ç»Ÿä¸­ç»Ÿä¸€
- ä¾¿äºè·¨ç³»ç»ŸæŸ¥è¯¢å’Œå…³è”

### 4. ç”¨æˆ·å‹å¥½
- ç”¨æˆ·çœ‹åˆ°ç¼–å·èƒ½ç›´æ¥è¯†åˆ«
- ä¾¿äºæ²Ÿé€šå’ŒæŠ¥å‘Š

### 5. ä¾¿äºæŸ¥è¯¢
```sql
-- ä½¿ç”¨ä¸šåŠ¡ç¼–å·æŸ¥è¯¢
SELECT * FROM SystemLog WHERE targetId = 'HZ-2024-001'

-- æ¯”æ•°æ®åº“IDæ›´ç›´è§‚
SELECT * FROM SystemLog WHERE targetId = 'clx7k3m9n...'
```

## ğŸ”„ å®é™…åº”ç”¨ç¤ºä¾‹

### éšæ‚£å®Œæ•´æµç¨‹

```typescript
// 1. éšæ‚£ä¸ŠæŠ¥
const hazard = await prisma.hazardRecord.create({
  data: {
    code: 'HZ-2024-001',  // ç³»ç»Ÿç”Ÿæˆçš„ç¼–å·
    desc: 'ç”µçº¿è€åŒ–ä¸¥é‡',
    // ...
  }
});

await ActivityLogger.logCreate({
  userId: user.id,
  module: Modules.HAZARD,
  targetType: 'hazard',
  targetId: hazard.code,  // âœ… HZ-2024-001
  targetLabel: hazard.desc?.substring(0, 50),
  data: hazard,
  request,
});

// 2. éšæ‚£æ´¾å‘
await ActivityLogger.logUpdate({
  userId: user.id,
  module: Modules.HAZARD,
  targetType: 'hazard',
  targetId: hazard.code,  // âœ… ä¿æŒä¸€è‡´
  targetLabel: hazard.desc?.substring(0, 50),
  beforeData,
  afterData,
  request,
});

// 3. éšæ‚£æ•´æ”¹
await ActivityLogger.logAction({
  userId: user.id,
  action: 'RECTIFY',
  actionLabel: 'æäº¤æ•´æ”¹',
  module: Modules.HAZARD,
  targetType: 'hazard',
  targetId: hazard.code,  // âœ… æ•´ä¸ªæµç¨‹ä½¿ç”¨åŒä¸€ä¸ªç¼–å·
  targetLabel: hazard.desc?.substring(0, 50),
  details: 'å·²å®Œæˆç”µçº¿æ›´æ¢',
  request,
});
```

### æŸ¥è¯¢æŸä¸ªéšæ‚£çš„æ‰€æœ‰æ“ä½œè®°å½•

```typescript
// å‰ç«¯æŸ¥è¯¢
<ActivityLogViewer 
  targetType="hazard"
  targetId="HZ-2024-001"  // âœ… ä½¿ç”¨ä¸šåŠ¡ç¼–å·
/>

// APIæŸ¥è¯¢
const logs = await prisma.systemLog.findMany({
  where: {
    targetType: 'hazard',
    targetId: 'HZ-2024-001',  // âœ… ä½¿ç”¨ä¸šåŠ¡ç¼–å·
  },
  orderBy: { createdAt: 'desc' }
});
```

## ğŸ“ è¿ç§»ç°æœ‰ä»£ç 

å¦‚æœæ‚¨çš„ä»£ç ä¸­ä½¿ç”¨äº†æ•°æ®åº“IDï¼Œè¯·æŒ‰ä»¥ä¸‹æ–¹å¼ä¿®æ”¹ï¼š

### ä¿®æ”¹å‰
```typescript
await ActivityLogger.logCreate({
  targetId: hazard.id,  // âŒ æ•°æ®åº“ID
  targetLabel: `éšæ‚£ ${hazard.code}`,
});
```

### ä¿®æ”¹å
```typescript
await ActivityLogger.logCreate({
  targetId: hazard.code,  // âœ… ä¸šåŠ¡ç¼–å·
  targetLabel: hazard.desc?.substring(0, 50),  // âœ… ä½¿ç”¨æè¿°
});
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿ä¸šåŠ¡ç¼–å·å”¯ä¸€æ€§**
   - æ¯ä¸ªä¸šåŠ¡å¯¹è±¡å¿…é¡»æœ‰å”¯ä¸€çš„ç¼–å·
   - å»ºè®®åœ¨æ•°æ®åº“ä¸­è®¾ç½®å”¯ä¸€çº¦æŸ

2. **ç¼–å·ç”Ÿæˆæ—¶æœº**
   - åœ¨åˆ›å»ºè®°å½•æ—¶ç«‹å³ç”Ÿæˆç¼–å·
   - ä¸è¦ç­‰åˆ°è®°å½•æ—¥å¿—æ—¶æ‰ç”Ÿæˆ

3. **ç¼–å·æ ¼å¼è§„èŒƒ**
   - å»ºç«‹ç»Ÿä¸€çš„ç¼–å·è§„åˆ™
   - ä½¿ç”¨æ˜“äºè¯†åˆ«çš„å‰ç¼€ï¼ˆå¦‚ HZ-ã€DOC-ï¼‰

4. **å‘åå…¼å®¹**
   - å¦‚æœç°æœ‰ç³»ç»Ÿå·²æœ‰æ•°æ®åº“IDçš„æ—¥å¿—
   - å¯ä»¥é€æ­¥è¿ç§»åˆ°ä¸šåŠ¡ç¼–å·
   - æˆ–åœ¨æŸ¥è¯¢æ—¶åŒæ—¶æ”¯æŒä¸¤ç§æ–¹å¼

## ğŸ‰ æ€»ç»“

| å­—æ®µ | å€¼ | è¯´æ˜ |
|------|-----|------|
| targetId | `HZ-2024-001` | âœ… ä¸šåŠ¡ç¼–å·ï¼Œç”¨æˆ·å‹å¥½ |
| targetLabel | `ç”µçº¿è€åŒ–ä¸¥é‡` | å¯¹è±¡çš„å¯è¯»æè¿° |
| targetType | `hazard` | å¯¹è±¡ç±»å‹ |

**è®°ä½ï¼šå§‹ç»ˆä½¿ç”¨ä¸šåŠ¡ç¼–å·ï¼ˆå¦‚ HZ-2024-001ï¼‰ä½œä¸º targetIdï¼Œè€Œä¸æ˜¯æ•°æ®åº“IDï¼**

---
æ›´æ–°æ—¶é—´ï¼š2026-01-02
