# æ“ä½œæ—¥å¿—ç³»ç»Ÿ - æ¨¡å—æŸ¥è¯¢ä¿®å¤æ€»ç»“

## ğŸ” é—®é¢˜è¯Šæ–­ç»“æœ

### æ•°æ®åº“å®é™…æƒ…å†µï¼ˆ2026-01-05ï¼‰

#### æŒ‰ module ç»Ÿè®¡
- `USER`: 18 æ¡
- `AUTH`: 14 æ¡
- `HAZARD`: 6 æ¡
- `SYSTEM`: 2 æ¡

#### æŒ‰ targetType ç»Ÿè®¡
- `user`: 32 æ¡
- `hazard`: 6 æ¡
- `template`: 2 æ¡

### æ ¸å¿ƒé—®é¢˜
ä¸åŒæ¨¡å—çš„æ—¥å¿—è®°å½•ä½¿ç”¨äº†ä¸åŒçš„æ ‡è¯†æ–¹å¼ï¼š
- éšæ‚£æ¨¡å—ï¼šåŒæ—¶æœ‰ `module='HAZARD'` å’Œ `targetType='hazard'`
- ä½œä¸šè®¸å¯/æ–‡æ¡£/åŸ¹è®­ï¼š**å°šæœªäº§ç”Ÿä»»ä½•æ—¥å¿—è®°å½•**

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. éšæ‚£ç®¡ç†æ¨¡å—
```typescript
// ä¿®æ”¹æŸ¥è¯¢å‚æ•°ä¸º targetTypeï¼ˆå› ä¸ºæ•°æ®åº“ä¸­æœ‰æ­¤å­—æ®µï¼‰
const params = new URLSearchParams({
  targetType: 'hazard',
  page: page.toString(),
  pageSize: pageSize.toString(),
});
```

**ä¿®æ”¹æ–‡ä»¶**: `src/app/hidden-danger/_components/views/SystemLogView.tsx`

**ç»“æœ**: âœ… å¯ä»¥æŸ¥è¯¢åˆ° 6 æ¡æ—¥å¿—

### 2. ä½œä¸šè®¸å¯æ¨¡å—
```typescript
// ä½¿ç”¨ targetType æŸ¥è¯¢ï¼Œç­‰å¾…åç«¯é›†æˆæ—¥å¿—åŠŸèƒ½
const params = new URLSearchParams({
  targetType: 'permit',
  page: pageNum.toString(),
  limit: limit.toString(),
});
```

**ä¿®æ”¹æ–‡ä»¶**: `src/components/work-permit/views/SystemLogView.tsx`

**ç»“æœ**: â³ ç­‰å¾…åç«¯APIé›†æˆæ—¥å¿—è®°å½•åŠŸèƒ½

### 3. æ–‡æ¡£ç®¡ç†æ¨¡å—
```typescript
// ä½¿ç”¨ targetType æŸ¥è¯¢
const params = new URLSearchParams({
  targetType: 'document',
  page: page.toString(),
  pageSize: pageSize.toString(),
});
```

**ä¿®æ”¹æ–‡ä»¶**: `src/app/docs/_components/SystemLogModal.tsx`

**ç»“æœ**: â³ ç­‰å¾…åç«¯APIé›†æˆæ—¥å¿—è®°å½•åŠŸèƒ½

### 4. åŸ¹è®­ç®¡ç†æ¨¡å—
```typescript
// ä½¿ç”¨ targetType æŸ¥è¯¢
const params = new URLSearchParams({
  targetType: 'training',
  page: page.toString(),
  pageSize: pageSize.toString(),
});
```

**ä¿®æ”¹æ–‡ä»¶**: `src/app/training/_components/SystemLogModal.tsx`

**ç»“æœ**: â³ ç­‰å¾…åç«¯APIé›†æˆæ—¥å¿—è®°å½•åŠŸèƒ½

### 5. ç³»ç»Ÿç®¡ç†æ¨¡å—
**çŠ¶æ€**: âœ… æ— éœ€ä¿®æ”¹

ç³»ç»Ÿç®¡ç†é¡µé¢ä½¿ç”¨ `/api/admin/logs`ï¼Œé€šè¿‡ `type` å‚æ•°åŒºåˆ†ç™»å½•æ—¥å¿—å’Œæ“ä½œæ—¥å¿—ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ¨¡å—çš„æ—¥å¿—ã€‚

## ğŸ“Š æŸ¥è¯¢ç­–ç•¥è¯´æ˜

### ç»Ÿä¸€ä½¿ç”¨ targetType æŸ¥è¯¢
ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨ `targetType` ä½œä¸ºæ¨¡å—è¿‡æ»¤æ¡ä»¶ï¼ŒåŸå› ï¼š

1. **å‘åå…¼å®¹**: ç°æœ‰çš„éšæ‚£æ—¥å¿—ä½¿ç”¨ `targetType='hazard'`
2. **ç›´è§‚è¯­ä¹‰**: targetType ç›´æ¥è¡¨ç¤ºä¸šåŠ¡å¯¹è±¡ç±»å‹
3. **ç®€åŒ–æŸ¥è¯¢**: é¿å… module å’Œ targetType çš„æ··ç”¨

### targetType æ˜ å°„å…³ç³»
| æ¨¡å— | targetType å€¼ | è¯´æ˜ |
|------|--------------|------|
| éšæ‚£ç®¡ç† | `hazard` | éšæ‚£å¯¹è±¡ |
| ä½œä¸šè®¸å¯ | `permit` | ä½œä¸šè®¸å¯å¯¹è±¡ |
| æ–‡æ¡£ç®¡ç† | `document` | æ–‡æ¡£å¯¹è±¡ |
| åŸ¹è®­ç®¡ç† | `training` | åŸ¹è®­/è¯¾ç¨‹å¯¹è±¡ |
| æ¨¡æ¿ç®¡ç† | `template` | ä½œä¸šç¥¨æ¨¡æ¿å¯¹è±¡ |
| ç”¨æˆ·ç®¡ç† | `user` | ç”¨æˆ·å¯¹è±¡ |

## ğŸ”§ åç»­éœ€è¦çš„å·¥ä½œ

### 1. ä½œä¸šè®¸å¯æ¨¡å—æ—¥å¿—é›†æˆ
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

éœ€è¦åœ¨ä»¥ä¸‹APIä¸­æ·»åŠ æ—¥å¿—è®°å½•ï¼š
- `/api/permits` - åˆ›å»º/æ›´æ–°/åˆ é™¤ä½œä¸šè®¸å¯
- `/api/permits/[id]/approve` - å®¡æ‰¹æ“ä½œ
- `/api/permits/[id]/complete` - å®Œå·¥æ“ä½œ

**ç¤ºä¾‹ä»£ç **:
```typescript
import AuditService from '@/services/audit.service';
import { LogModule, LogAction } from '@/types/audit';

// åœ¨åˆ›å»ºä½œä¸šè®¸å¯å
await AuditService.logCreate({
  userId: user.id,
  module: LogModule.WORK_PERMIT,
  targetType: 'permit',
  targetId: permit.id,
  targetLabel: permit.code,
  data: permit,
  request
});
```

### 2. æ–‡æ¡£æ¨¡å—æ—¥å¿—é›†æˆ
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

éœ€è¦åœ¨æ–‡æ¡£APIä¸­æ·»åŠ æ—¥å¿—è®°å½•ï¼š
- ä¸Šä¼ æ–‡æ¡£
- åˆ é™¤æ–‡æ¡£
- ä¸‹è½½æ–‡æ¡£

### 3. åŸ¹è®­æ¨¡å—æ—¥å¿—é›†æˆ
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

éœ€è¦åœ¨åŸ¹è®­APIä¸­æ·»åŠ æ—¥å¿—è®°å½•ï¼š
- åˆ›å»º/æ›´æ–°è¯¾ç¨‹
- å­¦å‘˜å­¦ä¹ è®°å½•
- è¯ä¹¦é¢å‘

## ğŸ“ˆ éªŒè¯æ–¹æ³•

### æµ‹è¯•è„šæœ¬
ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬éªŒè¯ï¼š
```bash
node scripts/test-log-queries.js
```

### æ‰‹åŠ¨æµ‹è¯•
1. è®¿é—®å„æ¨¡å—çš„æ—¥å¿—é¡µé¢
2. æ£€æŸ¥æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤ºæ—¥å¿—
3. æµ‹è¯•ç­›é€‰å’Œåˆ†é¡µåŠŸèƒ½

### é¢„æœŸç»“æœ
- âœ… éšæ‚£æ¨¡å—ï¼šæ˜¾ç¤ºç°æœ‰çš„ 6 æ¡æ—¥å¿—
- â³ ä½œä¸šè®¸å¯ï¼šæ˜¾ç¤º"æš‚æ— æ—¥å¿—"ï¼ˆç­‰å¾…APIé›†æˆï¼‰
- â³ æ–‡æ¡£æ¨¡å—ï¼šæ˜¾ç¤º"æš‚æ— æ—¥å¿—"ï¼ˆç­‰å¾…APIé›†æˆï¼‰
- â³ åŸ¹è®­æ¨¡å—ï¼šæ˜¾ç¤º"æš‚æ— æ—¥å¿—"ï¼ˆç­‰å¾…APIé›†æˆï¼‰
- âœ… ç³»ç»Ÿç®¡ç†ï¼šæ˜¾ç¤ºæ‰€æœ‰æ¨¡å—çš„æ—¥å¿—

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `æ—¥å¿—ç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š.md` - è¯¦ç»†è¯Šæ–­ä¿¡æ¯
- `æ“ä½œæ—¥å¿—-æ¨¡å—éš”ç¦»å®ç°æ€»ç»“.md` - æ¨¡å—éš”ç¦»å®ç°è¯´æ˜
- `æ“ä½œæ—¥å¿—ç³»ç»Ÿ-README.md` - æ—¥å¿—ç³»ç»Ÿæ€»ä½“è¯´æ˜

## âœ… ä¿®å¤çŠ¶æ€

- [x] è¯Šæ–­é—®é¢˜æ ¹æº
- [x] ä¿®æ”¹å‰ç«¯æŸ¥è¯¢é€»è¾‘
- [x] æµ‹è¯•éªŒè¯ç°æœ‰æ¨¡å—
- [x] ç¼–å†™æ–‡æ¡£è¯´æ˜
- [ ] é›†æˆä½œä¸šè®¸å¯æ—¥å¿—
- [ ] é›†æˆæ–‡æ¡£ç®¡ç†æ—¥å¿—
- [ ] é›†æˆåŸ¹è®­ç®¡ç†æ—¥å¿—

**æœ€åæ›´æ–°**: 2026å¹´1æœˆ5æ—¥
