# 组织架构批量导入 - 快速上手指南

## 方案概述

通过Excel/CSV文件批量导入整个组织架构树，支持多层级部门结构的一次性创建。

## 核心特性

✅ **路径表达法**：使用 `/` 分隔符表达层级关系
✅ **自动建树**：系统自动识别层级，从上到下创建
✅ **智能排序**：自动按深度排序，保证父部门先创建
✅ **负责人绑定**：支持为每个部门指定负责人
✅ **增量导入**：可多次导入，自动跳过已存在部门
✅ **导出模板**：可导出现有架构作为模板

## Excel格式说明

```
部门路径                                    | 负责人账号  | 负责人姓名
-------------------------------------------|-----------|----------
公司名称                                    | admin     | 管理员
公司名称/一级部门A                          |           |
公司名称/一级部门A/二级部门A1               | user1     | 张三
公司名称/一级部门A/二级部门A2               |           |
公司名称/一级部门B                          | user2     | 李四
公司名称/一级部门B/二级部门B1               |           |
公司名称/一级部门B/二级部门B1/三级部门B1a   |           |
```

### 字段说明

1. **部门路径**（必填）
   - 完整路径，从根部门开始
   - 使用 `/` 分隔各层级
   - 示例：`华泰科技/生产部/生产一车间`

2. **负责人账号**（可选）
   - 用户的登录账号
   - 必须是已存在的用户
   - 留空表示暂不设置负责人

3. **负责人姓名**（可选）
   - 仅作参考显示
   - 实际以账号为准

## 使用步骤

### 第一步：准备Excel文件

推荐使用提供的模板文件：
- 文件位置：`/public/组织架构导入模板.csv`
- 或点击【导出架构】获取现有架构作为模板

### 第二步：编辑组织架构

在Excel或文本编辑器中编辑：

```csv
部门路径,负责人账号,负责人姓名
华泰科技有限公司,admin,管理员
华泰科技有限公司/EHS部,,,
华泰科技有限公司/EHS部/安全组,,,
华泰科技有限公司/生产部,,,
华泰科技有限公司/生产部/一车间,,,
```

### 第三步：保存为UTF-8格式

- Excel：另存为 → CSV UTF-8（逗号分隔）
- 记事本：另存为 → 编码选择 UTF-8

### 第四步：导入系统

1. 进入【组织架构】页面
2. 点击右上角【批量导入】按钮
3. 选择准备好的CSV文件
4. 系统自动解析并显示预览
5. 确认后开始导入

### 第五步：验证结果

- 查看导入报告（成功/失败数量）
- 检查组织架构图谱是否正确
- 失败项会显示具体原因

## 示例场景

### 场景1：全新公司架构

```csv
部门路径,负责人账号,负责人姓名
新公司,admin,
新公司/管理中心,,,
新公司/管理中心/人事部,,,
新公司/管理中心/财务部,,,
新公司/生产中心,,,
新公司/生产中心/一车间,,,
新公司/生产中心/二车间,,,
新公司/技术中心,,,
新公司/技术中心/研发部,,,
新公司/技术中心/质量部,,,
```

导入后效果：
```
新公司
├── 管理中心
│   ├── 人事部
│   └── 财务部
├── 生产中心
│   ├── 一车间
│   └── 二车间
└── 技术中心
    ├── 研发部
    └── 质量部
```

### 场景2：扩展现有部门

假设已有"华泰科技/生产部"，现在要扩展：

```csv
部门路径,负责人账号,负责人姓名
华泰科技/生产部/三车间,,,
华泰科技/生产部/四车间,,,
华泰科技/生产部/仓储组,,,
```

### 场景3：批量设置负责人

```csv
部门路径,负责人账号,负责人姓名
华泰科技/EHS部,wang.xm,王小明
华泰科技/生产部,li.hua,李华
华泰科技/技术部,zhang.san,张三
华泰科技/销售部,zhao.liu,赵六
```

## 常见问题

### Q1: 导入时提示"部门XX在组织架构中不存在"？
A: 这是指父级部门不存在。请确保路径完整，从根部门开始。

### Q2: 负责人设置失败？
A: 负责人账号必须已存在。建议先在账户管理创建用户，再导入架构。

### Q3: 如何处理重名部门？
A: 使用完整路径区分，例如：
- `公司/技术部/测试组`
- `公司/生产部/测试组`

### Q4: 可以修改现有部门吗？
A: 当前版本只支持新增，不支持修改。如需修改，请手动编辑或先删除再导入。

### Q5: 支持的最大层级？
A: 理论上无限制，但建议不超过5层，保持架构扁平化。

## 注意事项

⚠️ **重要**：导入前建议先【导出架构】备份现有数据

⚠️ **编码**：必须使用UTF-8编码，否则中文会乱码

⚠️ **路径**：必须从根部门开始的完整路径

⚠️ **顺序**：系统会自动排序，无需担心父子顺序

⚠️ **大量数据**：导入过程中请勿关闭页面

## 高级技巧

### 技巧1：从现有架构快速创建模板
1. 点击【导出架构】
2. 在导出的CSV基础上修改
3. 重新导入（已存在的部门会跳过）

### 技巧2：Excel公式批量生成路径
```
=A2&"/"&B2&"/"&C2
```
A列：公司名，B列：一级部门，C列：二级部门

### 技巧3：分批次导入
- 第一次：导入1-2级部门框架
- 第二次：补充3-4级详细部门
- 第三次：批量设置负责人

## 导入流程图

```
┌──────────────┐
│  准备CSV文件  │
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  编辑组织架构 │ ← 使用模板或导出的文件
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  保存UTF-8   │
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  点击导入按钮 │
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  系统自动解析 │ ← 验证格式、路径、负责人
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  显示预览确认 │
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  批量创建部门 │ ← 按层级从上到下创建
└──────┬───────┘
       │
       ↓
┌──────────────┐
│  显示导入报告 │ ← 成功/失败统计
└──────────────┘
```

## 联系支持

如遇到问题，请：
1. 查看本说明文档
2. 检查CSV文件格式
3. 查看导入失败原因
4. 联系系统管理员

---

**版本**：v1.0  
**更新日期**：2025-12-20
